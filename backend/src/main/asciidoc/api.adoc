[[rest-api]]
= Quarano REST API
:snippets: ../../../target/generated-snippets

== Fundamentals

=== Use of hypermedia

The Quarano REST API makes use of hypermedia elements in its responses to guide clients through business processes, indicate the availability of related resources and actions.
Clients are encouraged to make use of those control to signal that availability to users via UI controls and use the metadata exposed via the API to avoid semantic coupling to the representations.
The media type we use as foundation of our representations is http://stateless.co/hal_specification.html[HAL].

=== Status codes

=== Error responses

TODO

== Authentication

The Quarano REST API uses JWT token based authentication.
An authenticating HTTP resource is available via `/api/login`.

include::{snippets}/getting-started/login/curl-request.adoc[]

A successful login will contain a simple `next` link to point to which resource access to gather information about the currently logged in user, navigation options, etc.
However, in case a password is expired, there'll also appear a `change-password` link pointing to a resource to change the password to a new one.
At this point, clients should not allow any other operation than changing the password.

include::{snippets}/password-expired/login/links.adoc[]

=== Error scenarios

As the login may fail for a variety of reasons, the resource returns different HTTP status codes in case of failures:

* `401 Unauthorized` -- if the given credentials are invalid.
* `403 Forbidden` -- in case the account's associated case fails to meet additional business requirements.

In all cases, the response contains a human readable message to display to the user in `text/plain` format.

[[authentication.change-password]]
=== Changing the password

The necessity to change a users password will be indicated by a `change-password` link available in the response of a successful login.
To change the password, issue a request to the links target URI submitting the new password and the just returned authentication token:

include::{snippets}/password-expired/change-password/curl-request.adoc[]

The request takes the following attributes:

include::{snippets}/password-expired/change-password/auto-request-fields.adoc[]

[[authentication.password-reset]]
=== Resetting the password

A user can set a password request by following the `reset-password` link relation returned by the root resource.

include::{snippets}/password-reset/access-root-resource/curl-request.adoc[]
include::{snippets}/password-reset/access-root-resource/response-body.adoc[]
include::{snippets}/password-reset/access-root-resource/links.adoc[]

We can now follow that link and issue a `POST` request to it, to request a reset of our password:

include::{snippets}/password-reset/request-reset/curl-request.adoc[]
include::{snippets}/password-reset/request-reset/auto-request-fields.adoc[]

If that request is successful, an email containing a link to the user interface will be sent out to the email address just given.

include::{snippets}/password-reset/request-reset/response-body.adoc[]
include::{snippets}/password-reset/request-reset/links.adoc[]

Also, the password can be finally reset by following the `reset-password` link in turn, providing additional information.

include::{snippets}/password-reset/perform-reset/curl-request.adoc[]
include::{snippets}/password-reset/perform-reset/auto-request-fields.adoc[]

A successful reset will be confirmed by an HTTP `200 OK` as well as a link pointing to the login resource.

include::{snippets}/password-reset/perform-reset/response-body.adoc[]


[[user-details]]
== User details

After the login, resources available are advertised via the user details resource.
The response of the login request points to that in the `next` link.
Depending on the role of the logged in user, you'll find different links within that representation.
For example, a case agent will see the following links.

include::{snippets}/getting-started/agent-user-home/links.adoc[]

include::api-agent.adoc[leveloffset=+1]
include::api-user.adoc[leveloffset=+1]

== CSV Import/Export

=== Quarantine Export

include::{snippets}/csv-import-export/quarantine-order/auto-description.adoc[]

include::{snippets}/csv-import-export/quarantine-order/curl-request.adoc[]

The request takes the following attributes:

include::{snippets}/csv-import-export/quarantine-order/auto-request-parameters.adoc[]

That call will return a 200 OK and contain the CSV data as body.

include::{snippets}/csv-import-export/quarantine-order/response-body.adoc[]

== Frontend texts
=== GET

Even without authentication, it is possible to retrieve installation-specific texts from the Quarano REST API via `/api/frontendtexts`.

include::{snippets}/frontend-texts/get-texts/curl-request.adoc[]
include::{snippets}/frontend-texts/get-texts/response-body.adoc[]

The request takes the following attributes. Without parameters all frontend texts are returned.:

include::{snippets}/frontend-texts/get-texts/auto-request-parameters.adoc[]

=== PUT

With admin authentication, it is possible to reset installation-specific texts with the Quarano REST API via `/api/admin/frontendtexts`.

include::{snippets}/frontend-texts/put-texts/curl-request.adoc[]

The request requires the following path parameters.:

include::{snippets}/frontend-texts/put-texts/auto-path-parameters.adoc[]

In addition, the language of the text must be transmitted via the Content-Language header!

== Email texts
=== GET

Even without authentication, it is possible to retrieve installation-specific email texts from the Quarano REST API via `/api/emailtexts`.
The delivered texts are raw texts where the placeholders are not replaced.

include::{snippets}/email-texts/get-texts/curl-request.adoc[]
include::{snippets}/email-texts/get-texts/response-body.adoc[]

The request takes the following attributes. Without parameters all frontend texts are returned.:

include::{snippets}/email-texts/get-texts/auto-request-parameters.adoc[]

=== PUT

With admin authentication, it is possible to reset installation-specific email texts with the Quarano REST API via `/api/admin/emailtexts`.

include::{snippets}/email-texts/put-texts/curl-request.adoc[]

The request requires the following path parameters.:

include::{snippets}/email-texts/put-texts/auto-path-parameters.adoc[]

In addition, the language of the text must be transmitted via the Content-Language header!
